---
description: Google Sheetsのストーリーボード（スプシURL or ローカルCSV）からNanoBanana用プロンプトシートを抽出・生成する。「プロンプトシート」「NanoBananaプロンプト抽出」「スプシからプロンプト」「プロンプト一覧」等のキーワードで使用。
---

# NanoBanana プロンプトシート生成スキル

ストーリーボードのスプレッドシート（Google Sheets URL）またはローカルCSVから、NanoBanana用のプロンプトだけを抽出し、コピペしやすいテキスト形式で出力するスキル。

---

## トリガーキーワード

「プロンプトシート」「NanoBananaプロンプト抽出」「スプシからプロンプト」「プロンプト一覧」「NanoBanana用に抽出」

---

## 入力（2パターン）

### パターン1：Google Sheets URL
ユーザーがスプレッドシートのURLを貼る。

```
このスプシからプロンプトシート作って
https://docs.google.com/spreadsheets/d/XXXXX/edit?gid=YYYYYY#gid=YYYYYY
```

### パターン2：ローカルCSV
ユーザーがローカルのCSVファイルパスを指定する。

```
このCSVからプロンプトシート作って
C:\path\to\storyboard.csv
```

---

## ⚠️ 事前確認（重要）

スキル実行前に、以下の情報がユーザーから提供されているか確認する:

1. **シート名**（Google Sheets の場合）
   - URLに `gid=` が含まれていればシートを特定できるが、含まれていない場合は**必ずユーザーに聞く**
   - 「どのシートを使いますか？」と聞く
   - 例：「YouTubeを始める前にやっておくこと」

2. **出力ファイル名のベース**
   - シート名からデフォルトで命名する（例：`YouTubeを始める前に_NanoBananaプロンプト.txt`）

> [!IMPORTANT]
> ユーザーがシート名を伝え忘れていたら、**スクリプト実行前に必ず聞くこと**。間違ったシートから抽出すると全部やり直しになる。

---

## 処理手順（高速版）

### Google Sheets URLの場合

1. URLから `spreadsheet_id` と `gid` を抽出
   - `gid` が無い場合 → ユーザーにシート名を聞いて `gid` を特定する
2. CSV形式でダウンロード:
   ```powershell
   Invoke-WebRequest -Uri 'https://docs.google.com/spreadsheets/d/{id}/export?format=csv&gid={gid}' -OutFile 'raw_storyboard.csv'
   ```
3. 同梱スクリプトで一発変換:
   ```
   // turbo
   node "{このスキルのディレクトリ}/scripts/gen_nanobanana_sheet.js" "raw_storyboard.csv" "{出力ファイル名}.txt"
   ```

### ローカルCSVの場合

1. 同梱スクリプトで一発変換:
   ```
   // turbo
   node "{このスキルのディレクトリ}/scripts/gen_nanobanana_sheet.js" "{CSVパス}" "{出力ファイル名}.txt"
   ```

---

## 出力形式

**テキストファイル**（`.txt`）— NanoBananaにそのままコピペできる形式。

### ブロック構成（1カットあたり）

```
────────────────────────────────────────────────────────────
【カット{番号}】{セクション名}
────────────────────────────────────────────────────────────

▼ 台本（参考）
{ナレーション全文}

▼ プロンプト パターン1（↓これをコピペ）
{NanoBanana パターン1}

▼ プロンプト パターン2（↓これをコピペ）
{NanoBanana パターン2}

```

---

## 列のマッピング

ストーリーボードCSVの列構成（storyboard スキル準拠）:

| CSV列 | インデックス | 用途 |
|---|---|---|
| A: カット番号 | 0 | 【カットN】の番号 |
| B: セクション | 1 | セクション名 |
| D: ナレーション | 3 | 台本（参考）テキスト |
| H: NanoBanana パターン1 | 7 | プロンプト パターン1 |
| I: NanoBanana パターン2 | 8 | プロンプト パターン2 |

> **注意**: 列がずれている場合（カスタムスプシ等）は、ユーザーに確認してからマッピングを調整する。

---

## 出力ファイル名の規則

```
{シート名 or CSV名}_NanoBananaプロンプト.txt
```

出力先は元のCSVと同じディレクトリ、またはユーザー指定のディレクトリ。

---

## リソースファイル

| ファイル | 内容 |
|----------|------|
| `scripts/gen_nanobanana_sheet.js` | CSVパース＋テキスト変換スクリプト |

---

## 注意事項

- `**太字**` のマークダウン記法はナレーション表示時に除去する
- 画面収録カット（プロンプトが「（実際の画面収録を使用）」）はスキップ
- パターン1のみ / パターン2のみの場合は、あるものだけ出力
- BOM不要（テキストファイルなので）
- Google Sheetsが読み込めない場合は `read_url_content` でCSVエクスポートURLからチャンク取得を試す
